<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<link rel="icon" type="image/png" href="https://raw.githubusercontent.com/TWei-1101/Split-Expense-Tracker/main/apple-touch-icon.png">
	<link rel="apple-touch-icon" sizes="180x180" href="https://raw.githubusercontent.com/TWei-1101/Split-Expense-Tracker/main/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="192x192" href="https://raw.githubusercontent.com/TWei-1101/Split-Expense-Tracker/main/apple-touch-icon-192.png">
	<link rel="apple-touch-icon" sizes="250x250" href="https://raw.githubusercontent.com/TWei-1101/Split-Expense-Tracker/main/apple-touch-icon-250.png">
    <link rel="apple-touch-icon" sizes="512x512" href="https://raw.githubusercontent.com/TWei-1101/Split-Expense-Tracker/main/apple-touch-icon-512.png">
	<title>ÂàÜÂ∏≥Ë®òÂ∏≥Á∞ø</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        input[type='number'] { -moz-appearance: textfield; }
        input[type='number']::-webkit-inner-spin-button,
        input[type='number']::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        .force-gpu { transform: translateZ(0); will-change: transform; }
    </style>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primaryColor: {
                            500: '#14b8a6',
                            600: '#0d9488',
                            700: '#0f766e',
                        },
                    },
                }
            }
        }
    </script>
</head>
<body>
    <div id="root"></div>

    <script>
        const __app_id = "YOUR_APP_ID"; 
        const __firebase_config = JSON.stringify({
            apiKey: "AIzaSyB8l7Od781kGHyI9pXMLBXvzt7NuuIyq8c",
            authDomain: "splite-expense-tracker.firebaseapp.com",
            projectId: "splite-expense-tracker",
            storageBucket: "splite-expense-tracker.firebasestorage.app",
            messagingSenderId: "425612895494",
            appId: "1:425612895494:web:b5889f1d83cafb41d7ea87",
            measurementId: "G-FVS0WSGZD9"
        });
        const GEMINI_API_KEY = ""; 
    </script>

    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-firestore-compat.js"></script>
    
    <script type="text/babel">
        const React = window.React;
        const { useState, useEffect, useCallback, useMemo } = React;
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;
        const { firestore } = firebase;
        const serverTimestamp = firestore.FieldValue.serverTimestamp; 

        // ÂÑ≤Â≠ò Key
        const PREFERRED_CURRENCY_KEY = "user_preferred_currency";

        const HARDCODED_DEFAULT_RATES = {
            'TWD': 1.0, 'CNY': 4.5, 'USD': 30.5, 'THB': 0.85, 'EUR': 33.0, 'CAD': 22.5,
            'VND': 0.0013, 'IDR': 0.002, 'JPY': 0.25, 'KRW': 0.023, 'AUD': 20.0, 'NOK': 2.9,
        };
        const CURRENCIES = Object.keys(HARDCODED_DEFAULT_RATES);
        const DEFAULT_CURRENCY = 'TWD';

        // --- Ê†∏ÂøÉÂåØÁéáÊäìÂèñ ---
		const fetchExchangeRates = async () => {
			const CACHE_KEY = "exchangeRatesCache";
			const CACHE_TIME_KEY = "exchangeRatesCacheTime";
			try {
				const cachedRates = localStorage.getItem(CACHE_KEY);
				const cachedTime = localStorage.getItem(CACHE_TIME_KEY);
				if (cachedRates && cachedTime && (Date.now() - parseInt(cachedTime)) < 14400000) {
					return { rates: JSON.parse(cachedRates), lastUpdate: parseInt(cachedTime) };
				}
			} catch (err) {}
			try {
				const res = await fetch("https://open.er-api.com/v6/latest/TWD");
				const data = await res.json();
				const processedRates = { [DEFAULT_CURRENCY]: 1.0 };
				CURRENCIES.forEach(code => {
					processedRates[code] = data.rates[code] ? 1 / data.rates[code] : HARDCODED_DEFAULT_RATES[code];
				});
				localStorage.setItem(CACHE_KEY, JSON.stringify(processedRates));
				localStorage.setItem(CACHE_TIME_KEY, Date.now().toString());
				return { rates: processedRates, lastUpdate: Date.now() };
			} catch (err) {
				return { rates: HARDCODED_DEFAULT_RATES, lastUpdate: Date.now() };
			}
		};

        // --- SVG Icons ---
        const IconProps = { stroke: "currentColor", strokeWidth: 2, strokeLinecap: "round", strokeLinejoin: "round", fill: "none" };
        const CircleDollarSign = (p) => <svg {...p} {...IconProps} viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" x2="8" y1="13" y2="13"/><line x1="16" x2="8" y1="17" y2="17"/><line x1="10" x2="8" y1="9" y2="9"/></svg>;
        const Trash2 = (p) => <svg {...p} {...IconProps} viewBox="0 0 24 24"><path d="M3 6h18m-2 0v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2m-6 5v6m4-6v6"/></svg>;
        const Plus = (p) => <svg {...p} {...IconProps} viewBox="0 0 24 24"><path d="M12 5v14m-7-7h14"/></svg>;
        const Minus = (p) => <svg {...p} {...IconProps} viewBox="0 0 24 24"><path d="M5 12h14"/></svg>;
        const Users = (p) => <svg {...p} {...IconProps} viewBox="0 0 24 24"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87M16 3.13a4 4 0 0 1 0 7.75"/></svg>;
        const X = (p) => <svg {...p} {...IconProps} viewBox="0 0 24 24"><path d="M18 6 6 18M6 6l12 12"/></svg>;
        const CircleCheck = (p) => <svg {...p} {...IconProps} viewBox="0 0 24 24"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14 9 11"/></svg>;
        const Pencil = (p) => <svg {...p} {...IconProps} viewBox="0 0 24 24"><path d="M17 3a2.85 2.85 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"/></svg>;
        const LogOut = (p) => <svg {...p} {...IconProps} viewBox="0 0 24 24"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4m7 14 5-5-5-5m5 5H9"/></svg>;
        const Search = (p) => <svg {...p} {...IconProps} viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>;
        const Share2 = (p) => <svg {...p} {...IconProps} viewBox="0 0 24 24"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.42" y1="6.51" x2="8.59" y2="10.49"/></svg>;

        /** * 1. ÊîØÂá∫ Modal 
         */
        const ExpenseModal = React.memo(({ db, currentUserId, members, getInitialShares, state, onClose, getDisplayName, isReadOnly, collectionId, liveExchangeRates, defaultCurrency }) => {
            const [newExpense, setNewExpense] = useState({ description: '', originalAmount: '', currency: DEFAULT_CURRENCY, payerName: '', shares: {} });
            const [isLoadingModal, setIsLoadingModal] = useState(false);
            const [modalError, setModalError] = useState(null);

            const isEditing = state.isEditing;
            const expenseToEdit = state.editingExpense;
            const currentExchangeRate = liveExchangeRates[newExpense.currency] || HARDCODED_DEFAULT_RATES[newExpense.currency] || 1.0;

            useEffect(() => {
                if (state.isOpen) {
                    if (isEditing && expenseToEdit) {
                        const initialShares = members.reduce((acc, name) => ({ ...acc, [name]: expenseToEdit.shares[name] ?? 0 }), {});
                        setNewExpense({ ...expenseToEdit, shares: initialShares });
                    } else {
                        // ‚ú® Ë®òÊÜ∂Âπ£Âà•ÈÇèËºØ
                        const savedCurrency = localStorage.getItem(PREFERRED_CURRENCY_KEY);
                        setNewExpense({
                            description: '', originalAmount: '',
                            currency: savedCurrency || defaultCurrency || DEFAULT_CURRENCY,
                            payerName: currentUserId || members[0] || '',
                            shares: getInitialShares()
                        });
                    }
                    setModalError(null);
                }
            }, [state.isOpen, isEditing, expenseToEdit, members, currentUserId, getInitialShares, defaultCurrency]);

            const handleCurrencyChange = (e) => {
                const val = e.target.value;
                localStorage.setItem(PREFERRED_CURRENCY_KEY, val); // ‚ú® Â≠òÂÖ•ÊâãÂãïÈÅ∏Êìá
                setNewExpense(prev => ({ ...prev, currency: val }));
            };

            const saveExpense = async () => {
                if (isReadOnly || !db || !currentUserId) return;
                if (!newExpense.description.trim() || newExpense.originalAmount <= 0) { setModalError('Ë´ãÂ°´ÂØ´ÂÆåÊï¥Ë≥áË®ä'); return; }
                setIsLoadingModal(true);
                try {
                    const data = {
                        ...newExpense,
                        exchangeRate: currentExchangeRate,
                        amountInTWD: newExpense.originalAmount * currentExchangeRate,
                        shares: Object.fromEntries(Object.entries(newExpense.shares).filter(([_, s]) => s > 0)),
                        appId: appId,
                        ...(isEditing ? {} : { timestamp: serverTimestamp(), creatorId: currentUserId })
                    };
                    const path = `artifacts/${appId}/groups/${collectionId}/expenses`;
                    if (isEditing) await db.doc(`${path}/${expenseToEdit.id}`).update(data);
                    else await db.collection(path).add(data);
                    onClose();
                } catch (e) { setModalError(e.message); } finally { setIsLoadingModal(false); }
            };

            if (!state.isOpen) return null;
            return (
                <div className="fixed inset-0 bg-black bg-opacity-60 flex items-start justify-center p-4 z-50 overflow-y-auto force-gpu">
                    <div className="bg-white rounded-2xl w-full max-w-lg shadow-2xl my-8 flex flex-col">
                        <div className="p-6 border-b flex justify-between items-center">
                            <h3 className="text-xl font-bold">{isEditing ? 'Á∑®ËºØÊîØÂá∫' : 'Êñ∞Â¢ûÊîØÂá∫'}</h3>
                            <button onClick={onClose}><X className="w-6 h-6"/></button>
                        </div>
                        <div className="p-6 space-y-4">
                            {modalError && <p className="text-red-500 bg-red-50 p-3 rounded-lg text-sm">{modalError}</p>}
                            <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                <div>
                                    <label className="text-sm font-bold text-gray-600">ÂìÅÈ†Ö</label>
                                    <input type="text" value={newExpense.description} onChange={e=>setNewExpense(p=>({...p, description: e.target.value}))} className="w-full border rounded-xl p-3 mt-1"/>
                                </div>
                                <div>
                                    <label className="text-sm font-bold text-gray-600">ÈáëÈ°çËàáÂπ£Âà•</label>
                                    <div className="flex gap-2 mt-1">
                                        <select value={newExpense.currency} onChange={handleCurrencyChange} className="border rounded-xl p-3 bg-gray-50">
                                            {CURRENCIES.map(c => <option key={c} value={c}>{c}</option>)}
                                        </select>
                                        <input type="number" value={newExpense.originalAmount} onChange={e=>setNewExpense(p=>({...p, originalAmount: e.target.value}))} className="w-full border rounded-xl p-3"/>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <label className="text-sm font-bold text-gray-600">‰ªòÊ¨æ‰∫∫</label>
                                <select value={newExpense.payerName} onChange={e=>setNewExpense(p=>({...p, payerName: e.target.value}))} className="w-full border rounded-xl p-3 mt-1 bg-white">
                                    {members.map(m => <option key={m} value={m}>{getDisplayName(m)}</option>)}
                                </select>
                            </div>
                            <div className="border-t pt-4">
                                <p className="font-bold mb-3">ÂàÜÂ∏≥‰ªΩÊï∏</p>
                                <div className="space-y-2">
                                    {members.map(m => (
                                        <div key={m} className="flex justify-between items-center bg-gray-50 p-3 rounded-xl border">
                                            <span className="truncate pr-4">{getDisplayName(m)}</span>
                                            <div className="flex items-center gap-3">
                                                <button onClick={()=>setNewExpense(p=>({...p, shares:{...p.shares, [m]: Math.max(0, (p.shares[m]||0)-1)}}))} className="p-1 bg-white border rounded shadow-sm text-red-500"><Minus className="w-5 h-5"/></button>
                                                <span className="w-6 text-center font-bold">{newExpense.shares[m]||0}</span>
                                                <button onClick={()=>setNewExpense(p=>({...p, shares:{...p.shares, [m]: (p.shares[m]||0)+1}}))} className="p-1 bg-white border rounded shadow-sm text-green-500"><Plus className="w-5 h-5"/></button>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>
                        <div className="p-6 border-t flex justify-end">
                            <button onClick={saveExpense} disabled={isLoadingModal} className="bg-primaryColor-600 text-white px-8 py-3 rounded-full font-bold shadow-lg disabled:bg-gray-400">
                                {isLoadingModal ? 'ÂÑ≤Â≠ò‰∏≠...' : 'Á¢∫Ë™çÂÑ≤Â≠ò'}
                            </button>
                        </div>
                    </div>
                </div>
            );
        });

        /** * 2. ÁµêÈ§òÁ∏ΩÁµêÂÖÉ‰ª∂
         */
        const BalanceSummary = React.memo(({ settlements, balances, getDisplayName, settleMemberDebt }) => (
            <div className="mt-8 p-6 bg-white rounded-2xl shadow-xl border border-gray-100">
                <h2 className="text-xl font-bold mb-4 flex items-center"><Users className="w-6 h-6 mr-2 text-primaryColor-500"/>ÁµêÈ§òÁ∏ΩÁµê</h2>
                {settlements.length === 0 ? <p className="text-green-600 font-medium bg-green-50 p-4 rounded-xl text-center">üéâ Â∏≥ÁõÆÂ∑≤Ê∏ÖÔºÅ</p> : (
                    <div className="space-y-3">
                        {settlements.map((s, i) => (
                            <div key={i} className="flex justify-between items-center bg-orange-50 p-4 rounded-xl border border-orange-100">
                                <div>
                                    <span className="font-bold text-red-600">{getDisplayName(s.from)}</span> Êáâ‰ªò 
                                    <span className="font-bold text-green-600 ml-1">{getDisplayName(s.to)}</span>
                                    <p className="text-2xl font-black text-orange-700 mt-1">TWD {s.amount.toFixed(0)}</p>
                                </div>
                                <button onClick={()=>settleMemberDebt(s.from, s.amount, s.to)} className="bg-green-600 text-white px-4 py-2 rounded-lg text-sm font-bold shadow-sm">ÁµêÊ∏Ö</button>
                            </div>
                        ))}
                    </div>
                )}
            </div>
        ));

        /** * 3. ÊîØÂá∫Ê∏ÖÂñÆÂÖÉ‰ª∂
         */
        const ExpenseList = React.memo(({ expenses, deleteExpense, startEdit, getDisplayName, searchKeyword, setSearchKeyword }) => {
            const filtered = expenses.filter(e => (e.description||'').toLowerCase().includes(searchKeyword.toLowerCase()))
                                     .sort((a,b) => (b.timestamp||0) - (a.timestamp||0));
            return (
                <div className="mt-8">
                    <div className="flex justify-between items-center mb-4">
                        <h2 className="text-xl font-bold flex items-center"><CircleDollarSign className="w-6 h-6 mr-2 text-primaryColor-500"/>ÊîØÂá∫ÊòéÁ¥∞</h2>
                        <div className="relative">
                            <input type="text" placeholder="ÊêúÂ∞ã..." value={searchKeyword} onChange={e=>setSearchKeyword(e.target.value)} className="border rounded-full py-1.5 pl-9 pr-4 text-sm focus:ring-2 focus:ring-primaryColor-500"/>
                            <Search className="w-4 h-4 absolute left-3 top-2.5 text-gray-400"/>
                        </div>
                    </div>
                    <div className="space-y-3">
                        {filtered.length === 0 ? <p className="text-center text-gray-400 py-10 bg-white rounded-2xl shadow-sm italic">Â∞öÁÑ°Ë®òÈåÑ</p> : filtered.map(exp => (
                            <div key={exp.id} className="bg-white p-4 rounded-2xl shadow-sm border-l-4 border-primaryColor-500 flex justify-between items-center transition hover:shadow-md">
                                <div className="flex-grow min-w-0 pr-4">
                                    <p className="font-bold text-gray-800 truncate">{exp.description}</p>
                                    <p className="text-2xl font-black text-primaryColor-600">{exp.currency} {exp.originalAmount}</p>
                                    <div className="flex gap-2 text-xs text-gray-500 mt-1">
                                        <span className="bg-gray-100 px-2 py-0.5 rounded">‰ªò: {getDisplayName(exp.payerName)}</span>
                                        {exp.currency !== 'TWD' && <span className="bg-teal-50 text-teal-700 px-2 py-0.5 rounded">‚âà TWD {exp.amountInTWD?.toFixed(0)}</span>}
                                    </div>
                                </div>
                                <div className="flex gap-2">
                                    <button onClick={()=>startEdit(exp)} className="p-2 text-blue-500 hover:bg-blue-50 rounded-full border"><Pencil className="w-4 h-4"/></button>
                                    <button onClick={()=>deleteExpense(exp.id)} className="p-2 text-red-500 hover:bg-red-50 rounded-full border"><Trash2 className="w-4 h-4"/></button>
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        });

        /** * 4. ‰∏ªË¶Å App ÂÖÉ‰ª∂
         */
        const App = () => {
            const [db, setDb] = useState(null);
            const [userId, setUserId] = useState(null);
            const [authReady, setAuthReady] = useState(false);
            const [expenses, setExpenses] = useState([]);
            const [members, setMembers] = useState([]);
            const [customMembers, setCustomMembers] = useState([]);
            const [liveRates, setLiveRates] = useState(HARDCODED_DEFAULT_RATES);
            const [currentCollectionId, setCurrentCollectionId] = useState(null);
            const [searchKeyword, setSearchKeyword] = useState('');
            const [expenseModal, setExpenseModal] = useState({ isOpen: false, isEditing: false, editingExpense: null });

            // ÂàùÂßãÂåñ
            useEffect(() => {
                const app = firebase.initializeApp(firebaseConfig);
                const auth = app.auth(); setDb(app.firestore());
                auth.onAuthStateChanged(async user => {
                    const uid = user ? user.uid : (await auth.signInAnonymously()).user.uid;
                    setUserId(uid); setCurrentCollectionId(uid); setAuthReady(true);
                });
                fetchExchangeRates().then(r => setLiveRates(r.rates));
            }, []);

            // Êï∏ÊìöÁõ£ËÅΩ
            useEffect(() => {
                if (!db || !currentCollectionId) return;
                const unsub1 = db.collection(`artifacts/${appId}/groups/${currentCollectionId}/expenses`).onSnapshot(s => 
                    setExpenses(s.docs.map(d => ({ id: d.id, ...d.data(), timestamp: d.data().timestamp?.toDate() })))
                );
                const unsub2 = db.doc(`artifacts/${appId}/groups/${currentCollectionId}/settings/members`).onSnapshot(d => 
                    setCustomMembers(d.exists ? d.data().list || [] : [])
                );
                return () => { unsub1(); unsub2(); };
            }, [db, currentCollectionId]);

            useEffect(() => {
                setMembers([...new Set([currentCollectionId, ...customMembers])].filter(Boolean));
            }, [currentCollectionId, customMembers]);

            const getDisplayName = useCallback(id => (id === userId ? 'Êàë' : id.substring(0,8)), [userId]);

            // ÂàÜÂ∏≥Ë®àÁÆó
            const balances = useMemo(() => {
                const b = Object.fromEntries(members.map(m => [m, 0]));
                expenses.forEach(e => {
                    const totalS = Object.values(e.shares||{}).reduce((acc, v) => acc + v, 0);
                    if (totalS === 0) return;
                    const perS = (e.amountInTWD||0) / totalS;
                    if (b[e.payerName] !== undefined) b[e.payerName] += (e.amountInTWD||0);
                    Object.entries(e.shares||{}).forEach(([m, s]) => { if (b[m] !== undefined) b[m] -= (perS * s); });
                });
                return b;
            }, [expenses, members]);

            const settlements = useMemo(() => {
                const c = [], d = [], s = [], b = { ...balances };
                Object.entries(b).forEach(([m, v]) => v >= 1 ? c.push({m, v}) : (v <= -1 && d.push({m, v: -v})));
                let ci=0, di=0;
                while(ci < c.length && di < d.length) {
                    const amt = Math.min(c[ci].v, d[di].v);
                    if (amt >= 1) s.push({ from: d[di].m, to: c[ci].m, amount: amt });
                    c[ci].v -= amt; d[di].v -= amt;
                    if (c[ci].v < 1) ci++; if (d[di].v < 1) di++;
                }
                return s;
            }, [balances]);

            const settleMemberDebt = async (from, amt, to) => {
                if (!db || !userId) return;
                try {
                    await db.collection(`artifacts/${appId}/groups/${currentCollectionId}/expenses`).add({
                        description: `[ÁµêÊ∏Ö] ${getDisplayName(from)} ÊîØ‰ªòÁµ¶ ${getDisplayName(to)}`,
                        originalAmount: Math.round(amt), currency: 'TWD', exchangeRate: 1, amountInTWD: Math.round(amt),
                        payerName: from, shares: { [to]: Math.round(amt) }, timestamp: serverTimestamp(), creatorId: userId, appId
                    });
                } catch (e) { alert(e.message); }
            };

            if (!authReady) return <div className="h-screen flex items-center justify-center bg-gray-50 text-primaryColor-600 font-bold">ËºâÂÖ•‰∏≠...</div>;

            return (
                <div className="min-h-screen bg-gray-50 pb-20">
                    <div className="max-w-xl mx-auto p-4 sm:p-6">
                        <header className="py-6 flex justify-between items-center">
                            <div>
                                <h1 className="text-3xl font-black text-primaryColor-700 tracking-tight">ÂàÜÂ∏≥Ë®òÂ∏≥Á∞ø</h1>
                                <p className="text-xs text-gray-400 font-medium mt-1 uppercase tracking-widest">Expense Tracker</p>
                            </div>
                            <div className="text-right">
                                <span className="text-[10px] bg-white px-2 py-1 rounded-full border text-gray-500 shadow-sm">
                                    Âπ£Âà•: {localStorage.getItem(PREFERRED_CURRENCY_KEY) || 'Ëá™Âãï'}
                                </span>
                            </div>
                        </header>

                        <div className="sticky top-4 z-30">
                            <button onClick={()=>setExpenseModal({isOpen:true, isEditing:false})} className="w-full bg-primaryColor-600 text-white p-4 rounded-2xl shadow-xl hover:scale-[1.02] transform transition font-bold text-lg flex items-center justify-center gap-2">
                                <Plus className="w-6 h-6"/>Êñ∞Â¢ûÊîØÂá∫Ë®òÈåÑ
                            </button>
                        </div>

                        <BalanceSummary settlements={settlements} balances={balances} getDisplayName={getDisplayName} settleMemberDebt={settleMemberDebt} />
                        
                        <ExpenseList expenses={expenses} deleteExpense={id=>db.doc(`artifacts/${appId}/groups/${currentCollectionId}/expenses/${id}`).delete()} startEdit={e=>setExpenseModal({isOpen:true, isEditing:true, editingExpense:e})} getDisplayName={getDisplayName} searchKeyword={searchKeyword} setSearchKeyword={setSearchKeyword} />

                        <ExpenseModal db={db} currentUserId={userId} members={members} getInitialShares={()=>Object.fromEntries(members.map(m=>[m,1]))} state={expenseModal} onClose={()=>setExpenseModal({isOpen:false})} getDisplayName={getDisplayName} isReadOnly={false} collectionId={currentCollectionId} liveExchangeRates={liveRates} defaultCurrency={null} />
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
